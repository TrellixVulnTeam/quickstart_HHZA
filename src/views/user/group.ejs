<!DOCTYPE html>
<html>

<head>
  <%# html viewport %>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title><%= title %></title>

  <%# css dependencies  %>
  <% include partials/dependencies/style %>
    <script>
    function showMsg(message) {
        document.getElementById("showMessage").innerHTML = message;
    }

    function showError(responseText) {
        var errorReason = JSON.parse(responseText).message;
        showMsg(errorReason);
    }

    // Performs an ajax call to delete group
    // Automatically refreshes all entries in #groupTable when done
    function deleteGroup(groupname) {
		var xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
            // Display Success/Failure message
            var success = this.status === 200;
            if (success) showMsg("Success");
            else showError(this.responseText);
            // Refresh table entries
            populateGroupTable();
        };
		xhttp.open('DELETE', '/api/groups/' + groupname);
		xhttp.send();
    }

    // Creates a button that when clicked, calls the deleteGroup() function
    function deleteGroupBtn(groupname) {
        groupname = "'" + groupname + "'";
		var code = '';
		code += '<button onclick="deleteGroup(' + groupname + ')">';
		code += 'Delete';
		code += '</button>';
		return code;
	}

    // Refreshes all entries in #groupTable
	function populateGroupTable() {
		var xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
            // Reset table innerHTML
            var table = document.getElementById("groupTable");
            table.innerHTML = "<tr><th>Name</th><th></th></tr>";
            // Dynamically insert row
            var arrayOfRows = JSON.parse(this.responseText);
            arrayOfRows.forEach(rowEntry => {
                var row = table.insertRow(-1);
                row.insertCell(-1).innerHTML = rowEntry.groupname;
                row.insertCell(-1).innerHTML = deleteGroupBtn(rowEntry.groupname);
            });
		};
		xhttp.open("GET", "/api/groups/", true);
		xhttp.send();
	}

    // Perform an ajax call to add group
    // Automatically refreshes all entries in #groupTable when done
    function addGroup() {
        var groupname = document.getElementById("groupname").value;

		var xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
            // Display Success/Failure message
            var success = this.status === 201;
            if (success) { showMsg("Success"); }
            else showError(this.responseText);
            // Refresh table entries
            populateGroupTable();
        };
		xhttp.open('POST', '/api/groups/');
        // Prepare POST parameters
        xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        var params = 'groupname=' + groupname;
		xhttp.send(params);
    }

  </script>

</head>

<body onload="populateGroupTable()">

  <div class="wrapper">
    <%# sidebar %>
    <% include partials/sidebar %>

    <%# page content  %>
    <div id="content">

      <%# navbar %>
      <% include partials/navbar %>

      <div class="content">

        <div class="container-fluid">

          <p id="showMessage"></p>

          <h2>Group</h2>
		  <table id="groupTable">
		  </table>
          <button onclick="populateGroupTable()">Refresh</button>

		  <h2 id='addGroup'>Add Group</h2>
            <form action='#addGroup' onsubmit='addGroup()'>
                <label for="groupname">Group Name:</label>
                <input type="text" id="groupname"><br>
                <input type='submit' value='Submit'>
            </form>

        </div>

      </div>

    </div>
  </div>

  <%# js dependencies  %>
  <% include partials/dependencies/script %>
</body>

</html>
